<!DOCTYPE html>
<html lang="en">

<head>
    <title>A brief interlude into Gleam concurrency | Josh&#x27;s Cool Dev Blog</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="robots" content="noodp"/>

    <link rel="stylesheet" href="https://josh.is-cool.dev/style.css">
    <link rel="stylesheet" href="https://josh.is-cool.dev/color/green-auto.css">

    <link rel="stylesheet" href="https://josh.is-cool.dev/font-hack-subset.css">

                <link rel="alternate" type="application/rss+xml" title="Josh&#x27;s Cool Dev Blog RSS Feed" href="https://josh.is-cool.dev/rss.xml" />
                <link rel="alternate" type="application/atom+xml" title="Josh&#x27;s Cool Dev Blog Atom Feed" href="https://josh.is-cool.dev/atom.xml" />
        <link rel="shortcut icon" type="image/png" href="/favicon.png">
    
<link rel="me" href="https://bne.social/@phocks" />
<link rel="me" href="https://ms.phocks.org/@josh" />
<link rel="me" href="https://masto.byrd.ws/@josh" />
<meta name="description" content="The dev blog of Joshua Byrd" />
<meta name="keywords" content="hacking, programming, ranting" />
<meta property="og:image" content="/favicon.png" />
<meta property="og:image:type" content="image/png" />
<meta name="google-site-verification" content="zAlHk1gMLdo06K0pmQamanclrMQZNDTuXW_m8UrD-_4" />
<style>
  abbr {
    cursor: help;
  }

  @media (hover: none) {
    abbr[title]:after {
      content: " (" attr(title) ")";
    }
  }

  ::selection {
    background: #ffb7b7;
    color: #000;
  }

  .z-code {
    margin-block: 1.5rem;
  }
</style>
<link rel="stylesheet" type="text/css" href="/syntax-theme-dark.css" media="(prefers-color-scheme: dark)" />
<link rel="stylesheet" type="text/css" href="/syntax-theme-light.css" media="(prefers-color-scheme: light)" />

<!-- Load JavaScript -->
<script type="module" defer async src="/index.js"></script>

<!-- Umami.is analytics tracking -->
<!-- Currently broken -->
<!-- <script defer src="https://umami.phocks.org/script.js" data-website-id="d3c5f87e-0f3f-41c8-84c2-a2d762155d0b"></script> -->

<meta name="fediverse:creator" content="@phocks@bne.social" />
<meta name="fediverse:creator" content="@josh@masto.byrd.ws" />
<link rel="alternate" type="application/rss+xml" title="Josh&#x27;s Cool Dev Blog RSS Feed"
  href="https://josh.is-cool.dev/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Josh&#x27;s Cool Dev Blog Atom Feed"
  href="https://josh.is-cool.dev/atom.xml" />

</head>

<body class="">
<div class="container">
    
    <header class="header">
        <div class="header__inner">
            <div class="header__logo">
                    
                <a href="https://josh.is-cool.dev" style="text-decoration: none;">
                    <div class="logo">
                      
                            josh@thinkpad:~&#x2F;src$
                        
                    </div>
                </a>
            </div>
        </div>

        
        
                <nav class="menu">
            <ul class="menu__inner">
                <li class="active"><a href="https://josh.is-cool.dev">blog</a></li>
            
                <li><a href="https://josh.is-cool.dev/about">about</a></li>
            
                <li><a href="https://josh.is-cool.dev/archive">archive</a></li>
            
                <li><a href="https://josh.is-cool.dev/tags">tags</a></li>
            
                <li><a href="https://josh.is-cool.dev/atom.xml">rss</a></li>
            </ul>
        </nav>
    
    
        
    </header>
    

    <div class="content">
        
    <div class="post">
        
    <h1 class="post-title"><a href="https://josh.is-cool.dev/a-brief-interlude-into-gleam-concurrency/">A brief interlude into Gleam concurrency</a></h1>
    <div class="post-meta-inline">
        
    <span class="post-date">
            2024-07-17
        </span>

    </div>

    
        <span class="post-tags-inline">
                :: tags:&nbsp;
                <a class="post-tag" href="https://josh.is-cool.dev/tags/concurrency/">#Concurrency</a>&nbsp;
                <a class="post-tag" href="https://josh.is-cool.dev/tags/gleam/">#Gleam</a>&nbsp;
                <a class="post-tag" href="https://josh.is-cool.dev/tags/programming/">#Programming</a></span>
    

        
        <div class="post-content">
            <p>I've been learning <a href="https://www.rust-lang.org/" title="The Rust programming language website">Rust</a> for a while now.</p>
<p>The other day I came across this little project called <a href="https://gleam.run/" title="The Gleam programming language website">Gleam</a>. It's a functional programming language. It's written in Rust. It compiles to JavaScript and Erlang. It borrows a lot of the good bits from Rust while hiding away a lot of the lower-level stuff.  It feels kinda like Rust-lite.</p>
<p>I was intrigued, so I took a quick look into it.</p>
<p>If you're also intrigued I recommend taking the <a href="https://tour.gleam.run/" title="The Gleam language tour">Gleam language tour</a>, or keep reading for a quick speedrun.</p>
<p>Gleam is easy to <a href="https://gleam.run/getting-started/installing/" title="Installation instruction for Gleam and Erlang etc.">install</a> via Homebrew or your system package manager.</p>
<p>New projects can be made with <code>gleam new my_project</code>.</p>
<p>Packages can be added with <code>gleam add</code>. Let's add <a href="https://hexdocs.pm/gleam_otp/" title="Gleam Open Telecom Platform">gleam_otp</a> with <code>gleam add gleam_otp</code>, which we'll use to spawn new tasks. It will now be an entry in your <code>gleam.toml</code> file, under <code>[dependencies]</code></p>
<pre class="z-code"><code><span class="z-text z-plain">gleam_otp = &quot;&gt;= 0.10.0 and &lt; 1.0.0&quot;
</span></code></pre>
<p>I'm interested in Gleam's concurrency handling, so let's test it out. Add the following code to <code>src/my_project.gleam</code> (an example from the Gleam homepage).</p>
<pre data-lang="gleam" class="language-gleam z-code"><code class="language-gleam" data-lang="gleam"><span class="z-source z-gleam"><span class="z-keyword z-control z-gleam">import</span> gleam<span class="z-keyword z-operator z-arithmetic z-int z-gleam">/</span>int
</span><span class="z-source z-gleam"><span class="z-keyword z-control z-gleam">import</span> gleam<span class="z-keyword z-operator z-arithmetic z-int z-gleam">/</span>io
</span><span class="z-source z-gleam"><span class="z-keyword z-control z-gleam">import</span> gleam<span class="z-keyword z-operator z-arithmetic z-int z-gleam">/</span>list
</span><span class="z-source z-gleam"><span class="z-keyword z-control z-gleam">import</span> gleam<span class="z-keyword z-operator z-arithmetic z-int z-gleam">/</span>otp<span class="z-keyword z-operator z-arithmetic z-int z-gleam">/</span>task
</span><span class="z-source z-gleam">
</span><span class="z-source z-gleam"><span class="z-keyword z-control z-gleam">fn</span> spawn_task(i) {
</span><span class="z-source z-gleam">  task<span class="z-constant z-numeric z-gleam">.</span>async(<span class="z-keyword z-control z-gleam">fn</span>() {
</span><span class="z-source z-gleam">    <span class="z-keyword z-control z-gleam">let</span> n <span class="z-keyword z-operator z-assignment z-gleam">=</span> int<span class="z-constant z-numeric z-gleam">.</span>to_string(i)
</span><span class="z-source z-gleam">    io<span class="z-constant z-numeric z-gleam">.</span>println(<span class="z-string z-quoted z-double z-gleam"><span class="z-punctuation z-definition z-string z-begin z-gleam">&quot;</span>Hello from <span class="z-punctuation z-definition z-string z-end z-gleam">&quot;</span></span> &lt;&gt; n)
</span><span class="z-source z-gleam">  })
</span><span class="z-source z-gleam">}
</span><span class="z-source z-gleam">
</span><span class="z-source z-gleam"><span class="z-keyword z-control z-gleam">pub</span> <span class="z-keyword z-control z-gleam">fn</span> main() {
</span><span class="z-source z-gleam">  <span class="z-comment z-line z-gleam"><span class="z-punctuation z-definition z-comment z-gleam">//</span> Run loads of threads, no problem</span>
</span><span class="z-source z-gleam">  list<span class="z-constant z-numeric z-gleam">.</span>range(<span class="z-constant z-numeric z-gleam">0</span>, 200_000)
</span><span class="z-source z-gleam">  <span class="z-keyword z-operator z-pipe z-gleam">|&gt;</span> list<span class="z-constant z-numeric z-gleam">.</span>map(spawn_task)
</span><span class="z-source z-gleam">  <span class="z-keyword z-operator z-pipe z-gleam">|&gt;</span> list<span class="z-constant z-numeric z-gleam">.</span>each(task<span class="z-constant z-numeric z-gleam">.</span>await_forever)
</span><span class="z-source z-gleam">}
</span></code></pre>
<p>Compile and run the code with <code>gleam run</code>.</p>
<p>You should see a whole bunch of hellos from different numbers. They appear, at first glance, to be counting in order from 0 to 200,000 like this.</p>
<pre class="z-code"><code><span class="z-text z-plain">Hello from 44790
</span><span class="z-text z-plain">Hello from 44791
</span><span class="z-text z-plain">Hello from 44792
</span><span class="z-text z-plain">Hello from 44793
</span><span class="z-text z-plain">Hello from 44795
</span><span class="z-text z-plain">Hello from 44794
</span><span class="z-text z-plain">Hello from 44796
</span><span class="z-text z-plain">Hello from 44797
</span><span class="z-text z-plain">Hello from 44798
</span><span class="z-text z-plain">Hello from 44799
</span></code></pre>
<p>The cool thing is though, that each of these tasks is being run concurrently (if you've got a multi-core processor that is ... I think) ...</p>
<p>... And if you scroll back up, you should see that some of the numbers are actually out of order. This is because sometimes — for whatever electronic reason I won't try to understand right now — one of the tasks makes it through your CPU faster than a previous one, thus overtaking it and printing its number out first.</p>
<p>Pretty cool, huh?</p>
<p>Looking forward to <a href="https://gleam.run/documentation/" title="Gleam main documentation page">exploring more</a>, and maybe using Gleam for when I don't need to be quite as close to the metal as Rust gets me.</p>
<hr />
<h2 id="update-2025-06-13">UPDATE 2025-06-13</h2>
<p>Seems like <code>gleam_otp</code> <a href="https://github.com/gleam-lang/otp">has released</a> a v1 which has removed support for <code>task</code> and they now use <code>actors</code>. I'll see if I can get my head around them and either do a new post or update this one.</p>

        </div>

        
        <div class="pagination">
            <div class="pagination__title">
                <span class="pagination__title-h">Would you like to know more?</span>
                <hr />
            </div>
            <div class="pagination__buttons">
                    <span class="button previous">
                        <a href="https://josh.is-cool.dev/a-custom-mastodon-favicon-while-you-wait/">
                            <span class="button__icon">←</span>&nbsp;
                            <span class="button__text">A custom Mastodon favicon while you wait</span>
                        </a>
                    </span>
                
                
                    <span class="button next">
                        <a href="https://josh.is-cool.dev/using-steps-for-performant-css-transitions/">
                            <span class="button__text">Using steps() for performant CSS transitions</span>&nbsp;
                            <span class="button__icon">→</span>
                        </a>
                    </span>
                </div>
        </div>
    
    </div>

    </div>

    
    <footer class="footer">
        <div class="footer__inner">
                <div class="copyright copyright--user">By Joshua Byrd :: Hit count #<span id="hit-count"></span></span></div>
            </div>
    </footer>
    

</div>
</body>

</html>
